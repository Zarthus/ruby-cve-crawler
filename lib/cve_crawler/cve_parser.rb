require 'nokogiri'
require 'cve_filter'
require 'cve_vulnerability'

module CVE
  class Parser
    def initialize(filters=nil)
      @filters = []

      @filters << CVE::Filter.new
      @filters << filters if filters
    end

    def parse(content)
      results = parse_xml(content)

      filter(results)
    end

    def parse_xml(content)
      xml = Nokogiri::XML(content)

      xml.at_xpath('//item')
      xml
    end

    def parse_items(items)

    end

    def parse_item(item)

    end

    def filter(results)
      filtered_contents = []

      results.each do |result|
        result_ok = true
        @filters.each do |filter|
          result_ok = result_ok && filter.filter(result)
        end

        filtered_contents << result if result_ok
      end

      filtered_contents
    end
  end
end
