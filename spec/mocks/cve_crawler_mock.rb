# Here we strip the extra XML and start from the items
# we trust the standard RSS and HTTP libraries, and the xml provided by the website works.
class CoreMock < CVE::Core
  def initialize(crawl_type='default', verify_cert=true, user_agent=nil, filters=nil)
    unless user_agent
      user_agent = create_user_agent
    end

    @crawler = CrawlerMock.new(crawl_type, verify_cert, user_agent)
    @parser = ParserMock.new(filters)
  end
end

class ParserMock < CVE::Parser
  def parse_rss_feed(content)
    items = RSSMock.new(content)

    parse_items(items)
  end
end

class CrawlerMock < CVE::Crawler
  def crawl
    result = []

    (rand(10) + 1).times do
      result << VulnerabilityMock.generate
    end

    HttpResultMock.new(result)
  end
end

class HttpResultMock
  def initialize(body)
    @body = body
  end

  attr_reader :body
end

class CrawlerResultMock
  def xml_full
    <<-eos
<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://purl.org/rss/1.0/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel rdf:about="http://web.nvd.nist.gov/view/vuln/search">
    <title>National Vulnerability Database</title>
    <link>http://web.nvd.nist.gov/view/vuln/search</link>
    <description>This feed contains the most recent CVE cyber vulnerabilities published within the National Vulnerability Database.</description>
    <items>
      <rdf:Seq>
        <rdf:li rdf:resource="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4476" />
        <rdf:li rdf:resource="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4500" />
        <rdf:li rdf:resource="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4501" />
     </rdf:Seq>
    </items>
    <dc:date>2015-09-27T04:50:00Z</dc:date>
    <dc:language>en-us</dc:language>
    <dc:rights>This material is not copywritten and may be freely used, however, attribution is requested.</dc:rights>
  </channel>
  <item rdf:about="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4476">
    <title>CVE-2015-4476 (firefox)</title>
    <link>http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4476</link>
    <description>Mozilla Firefox before 41.0 on Android allows user-assisted remote attackers to spoof address-bar attributes by leveraging lack of navigation after a paste of a URL with a nonstandard scheme, as demonstrated by spoofing an SSL attribute.</description>
    <dc:date>2015-09-24T04:59:00Z</dc:date>
  </item>
  <item rdf:about="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4500">
    <title>CVE-2015-4500 (firefox, firefox_esr)</title>
    <link>http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4500</link>
    <description>Multiple unspecified vulnerabilities in the browser engine in Mozilla Firefox before 41.0 and Firefox ESR 38.x before 38.3 allow remote attackers to cause a denial of service (memory corruption and application crash) or possibly execute arbitrary code via unknown vectors.</description>
    <dc:date>2015-09-24T04:59:02Z</dc:date>
  </item>
  <item rdf:about="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4501">
    <title>CVE-2015-4501 (firefox)</title>
    <link>http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-4501</link>
    <description>Multiple unspecified vulnerabilities in the browser engine in Mozilla Firefox before 41.0 allow remote attackers to cause a denial of service (memory corruption and application crash) or possibly execute arbitrary code via unknown vectors.</description>
    <dc:date>2015-09-24T04:59:03Z</dc:date>
  </item>
</rdf:RDF>
    eos
  end
end
